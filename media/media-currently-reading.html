<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currently Reading | My Media Diet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    <style>
        :root {
            --void: #030304; --abyss: #0a0a0c; --obsidian: #111114; --surface: #18181c;
            --glass-border: rgba(255, 255, 255, 0.06); --glass-hover: rgba(255, 255, 255, 0.1);
            --neon: #D4FF4F; --text-primary: #ffffff; --text-secondary: rgba(255, 255, 255, 0.7);
            --font-display: 'Playfair Display', Georgia, serif; --font-sans: 'Inter', -apple-system, sans-serif;
            --edge: clamp(24px, 6vw, 80px); --radius-lg: 20px; --radius-xl: 32px;
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1); --max-width: 1400px;
            --space-md: 16px; --space-lg: 24px; --space-xl: 32px; --space-2xl: 48px; --space-3xl: 64px;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }
        body { font-family: var(--font-sans); background: var(--void); color: var(--text-primary); line-height: 1.6; }
        ::selection { background: var(--neon); color: var(--void); }
        img { max-width: 100%; display: block; }
        a { color: inherit; text-decoration: none; }

        .back-nav {
            position: fixed; top: 32px; left: 32px; z-index: 1000;
            display: flex; align-items: center; gap: 12px;
            padding: 14px 24px; background: rgba(10, 10, 12, 0.9);
            backdrop-filter: blur(24px); border: 1px solid var(--glass-border);
            border-radius: 9999px; color: var(--text-primary);
            font-size: 0.9rem; font-weight: 500; transition: all 0.3s ease;
        }
        .back-nav:hover { border-color: var(--neon); transform: translateX(-4px); }

        .page-hero {
            padding: calc(var(--edge) + 80px) var(--edge) var(--space-3xl);
            text-align: center; max-width: var(--max-width); margin: 0 auto;
        }
        .page-title { font-family: var(--font-display); font-size: clamp(3rem, 8vw, 6rem); font-weight: 400; line-height: 0.9; margin-bottom: var(--space-lg); }
        .page-desc { font-size: 1.25rem; color: var(--text-secondary); max-width: 700px; margin: 0 auto var(--space-2xl); }
        .letterboxd-link { display: inline-flex; align-items: center; gap: 8px; color: var(--neon); font-weight: 600; margin-top: var(--space-lg); transition: opacity 0.3s ease; }
        .letterboxd-link:hover { opacity: 0.8; }

        .section { padding: var(--space-3xl) var(--edge); max-width: var(--max-width); margin: 0 auto; }
        .section-title { font-family: var(--font-display); font-size: clamp(2rem, 5vw, 3.5rem); margin-bottom: var(--space-xl); }
        .book-list { display: flex; flex-direction: column; gap: var(--space-lg); }
        .book-item {
            display: flex; gap: var(--space-lg); padding: var(--space-lg);
            background: var(--surface); border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg); transition: all 0.3s ease;
        }
        .book-item:hover { border-color: var(--neon); transform: translateX(4px); }
        .book-cover { width: 120px; height: 180px; border-radius: var(--radius-md); background: var(--glass-border); flex-shrink: 0; object-fit: cover; }
        .book-info { flex: 1; }
        .book-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 8px; }
        .book-meta { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px; }
        .book-progress { margin-top: 12px; }
        .progress-bar { width: 100%; height: 6px; background: var(--glass-border); border-radius: 9999px; overflow: hidden; margin-bottom: 8px; }
        .progress-fill { height: 100%; background: var(--neon); border-radius: 9999px; transition: width 0.3s ease; }
        .progress-text { font-size: 0.85rem; color: var(--text-secondary); }
        .show-more-btn {
            margin-top: var(--space-xl);
            padding: 14px 32px;
            background: var(--surface);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--neon);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .show-more-btn:hover {
            border-color: var(--neon);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 255, 79, 0.2);
        }
        .book-item.hidden { display: none; }

        @media (max-width: 768px) {
            .back-nav { top: 16px; left: 16px; padding: 12px 18px; }
            .book-item { flex-direction: column; }
            .book-cover { width: 100%; height: 300px; }
        }
    </style>
</head>
<body>

    <a href="../index-gemini-ultra.html#media-diet" class="back-nav">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back to My Media Diet
    </a>

    <section class="page-hero">
        <div style="display: flex; align-items: center; justify-content: center; gap: var(--space-lg); margin-bottom: var(--space-xl);">
            <img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/users/1565114141i/95365432._UX200_CR0,42,200,200_.jpg" alt="Joshua German" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--neon); object-fit: cover;" onerror="this.src='https://www.goodreads.com/images/nophoto/user/u_200x266-e183445fd1a1c5b227ee962133de211a.png';">
            <div style="text-align: left;">
                <h1 class="page-title" style="margin-bottom: 0; font-size: clamp(2rem, 6vw, 4rem);">Currently Reading</h1>
                <p class="page-desc" style="margin: var(--space-md) 0 0 0; font-size: 1.1rem; color: var(--neon); letter-spacing: 0.05em; text-transform: uppercase; font-weight: 700;">Joshua German on Goodreads</p>
            </div>
        </div>
        <p class="page-desc" style="margin-top: var(--space-xl);">Books I'm actively reading and making progress through.</p>
        <a href="https://www.goodreads.com/user/show/95365432-joshua-german" target="_blank" class="letterboxd-link" style="display: inline-flex; align-items: center; gap: 8px; color: var(--neon); font-weight: 600; margin-top: var(--space-lg);">
            View Full Profile on Goodreads
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 17L17 7M7 7h10v10"/></svg>
        </a>
    </section>

    <section class="section">
        <h2 class="section-title">In Progress</h2>
        <div class="book-list" id="currently-reading">
            <!-- Populate with current reads -->
        </div>
    </section>

    <section class="section">
        <h2 class="section-title">Recently Completed</h2>
        <div class="book-list" id="recently-completed">
            <!-- Populate with recently completed books -->
        </div>
    </section>

    <script>
        // Fetch all currently reading books from Goodreads
        async function fetchGoodreadsCurrentlyReading() {
            try {
                // Use Goodreads RSS feed for currently reading shelf
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://www.goodreads.com/review/list_rss/95365432?shelf=currently-reading&per_page=200')}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const parser = new DOMParser();
                const xml = parser.parseFromString(data.contents, 'text/xml');
                
                const items = Array.from(xml.querySelectorAll('item'));
                return items.map(item => {
                    const title = item.querySelector('title')?.textContent || '';
                    const author = item.querySelector('author_name')?.textContent || item.querySelector('author')?.textContent || '';
                    const bookId = item.querySelector('book_id')?.textContent || '';
                    const isbn = item.querySelector('isbn')?.textContent || '';
                    const imageUrl = item.querySelector('book_large_image_url')?.textContent || item.querySelector('book_image_url')?.textContent || '';
                    const link = item.querySelector('link')?.textContent || '';
                    const userReview = item.querySelector('user_review')?.textContent || '';
                    const userReadAt = item.querySelector('user_read_at')?.textContent || '';
                    const userDateAdded = item.querySelector('user_date_added')?.textContent || '';
                    
                    // Extract progress percentage from user_review or calculate from pages
                    let progress = 0;
                    const progressMatch = userReview.match(/(\d+)%/);
                    if (progressMatch) {
                        progress = parseInt(progressMatch[1]);
                    } else {
                        // Try to extract from description
                        const desc = item.querySelector('description')?.textContent || '';
                        const descProgressMatch = desc.match(/(\d+)%/);
                        if (descProgressMatch) {
                            progress = parseInt(descProgressMatch[1]);
                        }
                    }
                    
                    return {
                        title: title.replace(/ by .*$/, '').trim(),
                        author: author,
                        progress: progress,
                        cover: imageUrl || `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`,
                        goodreadsId: bookId,
                        link: link,
                        dateAdded: userDateAdded
                    };
                });
            } catch (error) {
                console.error('Error fetching Goodreads:', error);
                return [];
            }
        }

        // Fetch recently completed books
        async function fetchGoodreadsCompleted() {
            try {
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://www.goodreads.com/review/list_rss/95365432?shelf=read&per_page=10')}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const parser = new DOMParser();
                const xml = parser.parseFromString(data.contents, 'text/xml');
                
                const items = Array.from(xml.querySelectorAll('item'));
                return items.slice(0, 10).map(item => {
                    const title = item.querySelector('title')?.textContent || '';
                    const author = item.querySelector('author_name')?.textContent || item.querySelector('author')?.textContent || '';
                    const bookId = item.querySelector('book_id')?.textContent || '';
                    const isbn = item.querySelector('isbn')?.textContent || '';
                    const imageUrl = item.querySelector('book_large_image_url')?.textContent || item.querySelector('book_image_url')?.textContent || '';
                    const link = item.querySelector('link')?.textContent || '';
                    const userReadAt = item.querySelector('user_read_at')?.textContent || '';
                    const userRating = item.querySelector('user_rating')?.textContent || '';
                    
                    return {
                        title: title.replace(/ by .*$/, '').trim(),
                        author: author,
                        cover: imageUrl || `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`,
                        goodreadsId: bookId,
                        link: link,
                        completedDate: userReadAt,
                        rating: userRating ? parseInt(userRating) : null
                    };
                });
            } catch (error) {
                console.error('Error fetching completed books:', error);
                return [];
            }
        }

        // Fallback data if RSS fails
        const currentlyReadingData = [
            {
                title: "The Iliad",
                author: "Homer",
                progress: 12,
                cover: "https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1388188509l/1371._SY475_.jpg",
                goodreadsId: "1371",
                link: "https://www.goodreads.com/book/show/1371.The_Iliad"
            },
            {
                title: "The Revolution Was Televised: The Cops, Crooks, Slingers and Slayers Who Changed TV Drama Forever",
                author: "Alan Sepinwall",
                progress: 75,
                cover: "https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1352842910l/13588775._SY475_.jpg",
                goodreadsId: "13588775",
                link: "https://www.goodreads.com/book/show/13588775"
            },
            {
                title: "Invisible Doctrine: The Secret History of Neoliberalism",
                author: "George Monbiot",
                progress: 61,
                cover: "https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1689001200l/199101103._SY475_.jpg",
                goodreadsId: "199101103",
                link: "https://www.goodreads.com/book/show/199101103"
            }
        ];

        // Last 10 completed books in chronological order (most recent first)
        const recentlyCompletedData = [];
        const inProgressData = [];

        function renderBooks(containerId, items, showFirstN = null) {
            const container = document.getElementById(containerId);
            if (!container || !items || items.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No books found.</p>';
                return;
            }
            
            const itemsToShow = showFirstN ? items.slice(0, showFirstN) : items;
            const hiddenItems = showFirstN && items.length > showFirstN ? items.slice(showFirstN) : [];
            
            let html = itemsToShow.map((item, index) => {
                // Use multiple image URL formats for better loading
                const coverUrls = [
                    item.cover,
                    item.cover?.replace('_SY475_', '_SX318_'),
                    item.cover?.replace('_SY475_', '_SY160_'),
                    item.goodreadsId ? `https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/${item.goodreadsId.match(/\d{10}/)?.[0] || ''}l/${item.goodreadsId}._SY475_.jpg` : null
                ].filter(Boolean);
                
                return `
                    <div class="book-item" data-index="${index}">
                        <div style="position: relative; width: 120px; height: 180px; flex-shrink: 0;">
                            <img src="${coverUrls[0]}" 
                                 alt="${item.title}" 
                                 class="book-cover" 
                                 loading="lazy"
                                 style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--radius-md);"
                                 onerror="this.onerror=null; this.src='${coverUrls[1] || coverUrls[0]}'; if(!this.src) this.parentElement.innerHTML='<div class=\\'book-cover\\' style=\\'background: var(--glass-border); width: 100%; height: 100%; border-radius: var(--radius-md);\\'></div>';">
                        </div>
                        <div class="book-info">
                            <h3 class="book-title">${item.title}</h3>
                            <p class="book-meta">${item.author}${item.year ? ' • ' + item.year : ''}${item.completedDate ? ' • Completed ' + new Date(item.completedDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }) : ''}</p>
                            ${item.desc ? `<p style="color: var(--text-secondary); margin-top: 8px;">${item.desc}</p>` : ''}
                            ${item.progress !== undefined && item.progress < 100 && item.progress > 0 ? `
                                <div class="book-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${item.progress}%;"></div>
                                    </div>
                                    <p class="progress-text">${item.progress}% complete</p>
                                </div>
                            ` : ''}
                            ${item.rating ? `<p style="color: var(--neon); margin-top: 8px; font-size: 0.85rem;">${'★'.repeat(item.rating)}${'☆'.repeat(5 - item.rating)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add hidden items
            html += hiddenItems.map((item, index) => {
                const coverUrls = [
                    item.cover,
                    item.cover?.replace('_SY475_', '_SX318_'),
                    item.cover?.replace('_SY475_', '_SY160_'),
                    item.goodreadsId ? `https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/${item.goodreadsId.match(/\d{10}/)?.[0] || ''}l/${item.goodreadsId}._SY475_.jpg` : null
                ].filter(Boolean);
                
                return `
                    <div class="book-item hidden" data-index="${showFirstN + index}">
                        <div style="position: relative; width: 120px; height: 180px; flex-shrink: 0;">
                            <img src="${coverUrls[0]}" 
                                 alt="${item.title}" 
                                 class="book-cover" 
                                 loading="lazy"
                                 style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--radius-md);"
                                 onerror="this.onerror=null; this.src='${coverUrls[1] || coverUrls[0]}'; if(!this.src) this.parentElement.innerHTML='<div class=\\'book-cover\\' style=\\'background: var(--glass-border); width: 100%; height: 100%; border-radius: var(--radius-md);\\'></div>';">
                        </div>
                        <div class="book-info">
                            <h3 class="book-title">${item.title}</h3>
                            <p class="book-meta">${item.author}${item.year ? ' • ' + item.year : ''}</p>
                            ${item.progress !== undefined && item.progress < 100 && item.progress > 0 ? `
                                <div class="book-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${item.progress}%;"></div>
                                    </div>
                                    <p class="progress-text">${item.progress}% complete</p>
                                </div>
                            ` : ''}
                            ${item.rating ? `<p style="color: var(--neon); margin-top: 8px; font-size: 0.85rem;">${'★'.repeat(item.rating)}${'☆'.repeat(5 - item.rating)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add show more button if needed
            if (hiddenItems.length > 0) {
                html += `<button class="show-more-btn" onclick="showMoreBooks('${containerId}')">Show ${hiddenItems.length} More Books</button>`;
            }
            
            container.innerHTML = html;
        }

        function showMoreBooks(containerId) {
            const container = document.getElementById(containerId);
            const hiddenItems = container.querySelectorAll('.book-item.hidden');
            hiddenItems.forEach(item => {
                item.classList.remove('hidden');
            });
            const btn = container.querySelector('.show-more-btn');
            if (btn) btn.remove();
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Fetch from Goodreads RSS (always fetch fresh data)
            const [fetchedBooks, completedBooks] = await Promise.all([
                fetchGoodreadsCurrentlyReading(),
                fetchGoodreadsCompleted()
            ]);
            
            if (fetchedBooks.length > 0) {
                // Separate in progress from completed
                const inProgress = fetchedBooks.filter(b => b.progress < 100 || b.progress === 0);
                
                // Show first 5, then "Show More"
                renderBooks('currently-reading', inProgress, 5);
                
                // Show completed books (from separate fetch)
                renderBooks('recently-completed', completedBooks.length > 0 ? completedBooks : fetchedBooks.filter(b => b.progress >= 100).slice(0, 10));
            } else {
                // Use fallback data
                const inProgress = currentlyReadingData.filter(b => b.progress < 100);
                renderBooks('currently-reading', inProgress, 5);
                renderBooks('recently-completed', currentlyReadingData.filter(b => b.progress >= 100).slice(0, 10));
            }
        });
    </script>

</body>
</html>

